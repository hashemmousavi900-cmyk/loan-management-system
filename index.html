<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم وام - نسخه POST</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: Tahoma; }
        body { background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { background: #007cba; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #005a87; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #f0f0f0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>سیستم مدیریت وام - نسخه POST</h1>
        
        <div>
            <button class="btn" onclick="loadData()">بارگذاری داده‌ها</button>
            <button class="btn" onclick="saveData()">ذخیره همه داده‌ها</button>
            <button class="btn" onclick="addTestData()">اضافه کردن ۵۰ رکورد تست</button>
        </div>

        <table id="dataTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>شماره پرسنلی</th>
                    <th>نام کامل</th>
                    <th>وام بانکی</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbymE-RILJ8gCg4vLreCz5wchcQrx-mS5HzCmHEpuOu4RMl58Vma3rZlfJ_Ac1XUQzK0/exec';
        let allData = [];

        // بارگذاری داده‌ها با GET
        async function loadData() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=loadData`);
                const result = await response.json();
                
                if (result.success) {
                    allData = result.data;
                    renderTable();
                    alert(`بارگذاری شد: ${result.data.length} رکورد`);
                } else {
                    alert('خطا در بارگذاری: ' + result.error);
                }
            } catch (error) {
                alert('خطا: ' + error.message);
            }
        }

        // ذخیره داده‌ها با POST
        async function saveData() {
            if (allData.length === 0) {
                alert('داده‌ای برای ذخیره وجود ندارد');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('action', 'saveLargeData');
                formData.append('data', JSON.stringify(allData));

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    alert(`ذخیره شد: ${result.savedCount} رکورد`);
                } else {
                    alert('خطا در ذخیره: ' + result.error);
                }
            } catch (error) {
                alert('خطا: ' + error.message);
            }
        }

        // اضافه کردن داده تستی
        function addTestData() {
            for (let i = 1; i <= 50; i++) {
                allData.push({
                    Username: `user${i}`,
                    Employeenumber: `EMP${i.toString().padStart(3, '0')}`,
                    Fullname: `کاربر تست ${i}`,
                    Gender: i % 2 === 0 ? 'زن' : 'مرد',
                    Bankloan: `${i * 1000000} ریال`,
                    Companyloan: `${i * 500000} ریال`,
                    Bankloandate: '2024-01-01',
                    Companyloandate: '2024-01-01',
                    Priority: ((i % 3) + 1).toString(),
                    Description: `توضیحات تست ${i}`,
                    Loanrequest: i % 2 === 0
                });
            }
            renderTable();
            alert('۵۰ رکورد تست اضافه شد');
        }

        // نمایش جدول
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            allData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.Employeenumber}</td>
                    <td>${item.Fullname}</td>
                    <td>${item.Bankloan}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // بارگذاری اولیه
        loadData();
    </script>
</body>
</html>
